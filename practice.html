<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Test - EduAssess Pro</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>EduAssess Pro</h2>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="test-selection.html">Back to Tests</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="text-center" style="margin: 3rem 0;">
            <h1>üìù Practice Test Configuration</h1>
            <p>Configure your practice test settings</p>
            <p><small>üìÖ Questions from 2024 Practice Database</small></p>
        </div>

        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <!-- Debug Information -->
            <div id="debugInfo" style="background: #f0f0f0; padding: 10px; margin-bottom: 20px; border-radius: 5px; font-family: monospace; font-size: 12px;">
                <strong>Debug Info:</strong><br>
                <span id="debugText">Loading 2024 practice questions...</span>
            </div>

            <div class="test-config-section">
                <h3>üìä Available Subjects</h3>
                <div id="subjectsOverview" class="mb-lg">
                    <!-- Subject overview will be loaded here -->
                </div>

                <h3>‚öôÔ∏è Test Configuration</h3>
                <div class="config-options">
                    <div class="option-group">
                        <label for="testType">Test Type:</label>
                        <select id="testType" class="form-control">
                            <option value="all-subjects">All Subjects Mixed</option>
                            <option value="subject-wise">Subject-wise Sequential</option>
                            <option value="custom">Custom Selection</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="questionCount">Number of Questions:</label>
                        <select id="questionCount" class="form-control">
                            <option value="25">25 Questions</option>
                            <option value="50">50 Questions</option>
                            <option value="75">75 Questions</option>
                            <option value="all">All Available Questions</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="timeLimit">Time Limit:</label>
                        <select id="timeLimit" class="form-control">
                            <option value="30">30 Minutes</option>
                            <option value="60">1 Hour</option>
                            <option value="90">1.5 Hours</option>
                            <option value="120">2 Hours</option>
                        </select>
                    </div>

                    <div id="customSubjects" class="option-group" style="display: none;">
                        <label>Select Subjects:</label>
                        <div id="subjectCheckboxes">
                            <!-- Subject checkboxes will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="test-summary" id="testSummary">
                    <h4>üìã Test Summary</h4>
                    <div id="summaryContent">
                        <!-- Summary will be displayed here -->
                    </div>
                </div>

                <div class="text-center" style="margin-top: 2rem;">
                    <button id="startPracticeTest" class="btn btn-primary btn-large">
                        Start Practice Test
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Load ONLY 2024 questions for practice tests -->
    <script src="js/questions2024.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Loading Practice Test Configuration - 2024 Database');
            
            const debugText = document.getElementById('debugText');
            const subjectsOverview = document.getElementById('subjectsOverview');
            const testTypeSelect = document.getElementById('testType');
            const questionCountSelect = document.getElementById('questionCount');
            const timeLimitSelect = document.getElementById('timeLimit');
            const customSubjectsDiv = document.getElementById('customSubjects');
            const subjectCheckboxes = document.getElementById('subjectCheckboxes');
            const summaryContent = document.getElementById('summaryContent');
            const startButton = document.getElementById('startPracticeTest');
            
            let practiceQuestions = [];
            let subjectData = {};

            // Debug function
            function updateDebugInfo(message) {
                console.log('Debug:', message);
                debugText.innerHTML += message + '<br>';
            }

            // Initialize practice test data
            function initializePracticeData() {
                updateDebugInfo('Initializing practice test data from 2024 database...');
                
                // Get 2024 practice questions
                practiceQuestions = typeof practiceQuestions2024 !== 'undefined' ? practiceQuestions2024 : [];
                
                updateDebugInfo(`Found ${practiceQuestions.length} questions from 2024 practice database`);
                
                if (practiceQuestions.length === 0) {
                    updateDebugInfo('ERROR: No 2024 practice questions found! Check if questions2024.js is loaded correctly.');
                    subjectsOverview.innerHTML = '<p style="color: red;">No practice questions found in 2024 database. Please check your questions2024.js file.</p>';
                    return false;
                }

                // Group questions by subject
                subjectData = {};
                practiceQuestions.forEach((question, index) => {
                    if (!question.subject) {
                        updateDebugInfo(`Warning: Question ${index} missing subject property`);
                        return;
                    }
                    
                    const subject = question.subject;
                    if (!subjectData[subject]) {
                        subjectData[subject] = {
                            questions: [],
                            topics: new Set()
                        };
                    }
                    
                    subjectData[subject].questions.push(question);
                    if (question.topic) {
                        subjectData[subject].topics.add(question.topic);
                    }
                });

                // Convert topic sets to arrays
                Object.keys(subjectData).forEach(subject => {
                    subjectData[subject].topics = Array.from(subjectData[subject].topics);
                    updateDebugInfo(`${subject}: ${subjectData[subject].questions.length} questions, ${subjectData[subject].topics.length} topics`);
                });

                updateDebugInfo(`Subjects found in 2024 database: ${Object.keys(subjectData).join(', ')}`);
                return true;
            }

            // Display subjects overview
            function displaySubjectsOverview() {
                if (Object.keys(subjectData).length === 0) return;

                let overviewHTML = '<div class="subjects-grid">';
                
                Object.keys(subjectData).sort().forEach(subject => {
                    const data = subjectData[subject];
                    overviewHTML += `
                        <div class="subject-card">
                            <h4>üìñ ${subject}</h4>
                            <p><strong>Questions:</strong> ${data.questions.length}</p>
                            <p><strong>Topics:</strong> ${data.topics.length}</p>
                            <div class="topics-preview">
                                <small>${data.topics.slice(0, 3).join(', ')}${data.topics.length > 3 ? '...' : ''}</small>
                            </div>
                        </div>
                    `;
                });
                
                overviewHTML += '</div>';
                subjectsOverview.innerHTML = overviewHTML;
            }

            // Create subject checkboxes for custom selection
            function createSubjectCheckboxes() {
                subjectCheckboxes.innerHTML = '';
                
                Object.keys(subjectData).sort().forEach(subject => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `subject-${subject}`;
                    checkbox.value = subject;
                    checkbox.checked = true; // Default to checked
                    
                    const label = document.createElement('label');
                    label.htmlFor = `subject-${subject}`;
                    label.textContent = `${subject} (${subjectData[subject].questions.length} questions)`;
                    
                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);
                    subjectCheckboxes.appendChild(checkboxDiv);
                    
                    // Add change event listener
                    checkbox.addEventListener('change', updateTestSummary);
                });
            }

            // Update test summary
            function updateTestSummary() {
                const testType = testTypeSelect.value;
                const questionCount = questionCountSelect.value;
                const timeLimit = timeLimitSelect.value;
                
                let selectedSubjects = [];
                let totalQuestions = 0;
                
                if (testType === 'custom') {
                    // Get selected subjects
                    const checkboxes = subjectCheckboxes.querySelectorAll('input[type="checkbox"]:checked');
                    selectedSubjects = Array.from(checkboxes).map(cb => cb.value);
                    totalQuestions = selectedSubjects.reduce((sum, subject) => sum + subjectData[subject].questions.length, 0);
                } else {
                    selectedSubjects = Object.keys(subjectData);
                    totalQuestions = practiceQuestions.length;
                }
                
                let actualQuestions = totalQuestions;
                if (questionCount !== 'all') {
                    actualQuestions = Math.min(parseInt(questionCount), totalQuestions);
                }
                
                let summaryHTML = `
                    <div class="summary-item">
                        <strong>Test Type:</strong> ${testType.replace('-', ' ').toUpperCase()}
                    </div>
                    <div class="summary-item">
                        <strong>Selected Subjects:</strong> ${selectedSubjects.join(', ')}
                    </div>
                    <div class="summary-item">
                        <strong>Questions:</strong> ${actualQuestions} out of ${totalQuestions} available
                    </div>
                    <div class="summary-item">
                        <strong>Time Limit:</strong> ${timeLimit} minutes
                    </div>
                    <div class="summary-item">
                        <strong>Data Source:</strong> 2024 Practice Database
                    </div>
                `;
                
                summaryContent.innerHTML = summaryHTML;
                
                // Enable/disable start button
                startButton.disabled = selectedSubjects.length === 0;
            }

            // Start practice test
            function startPracticeTest() {
                const testType = testTypeSelect.value;
                const questionCount = questionCountSelect.value;
                const timeLimit = parseInt(timeLimitSelect.value) * 60; // Convert to seconds
                
                let selectedSubjects = [];
                if (testType === 'custom') {
                    const checkboxes = subjectCheckboxes.querySelectorAll('input[type="checkbox"]:checked');
                    selectedSubjects = Array.from(checkboxes).map(cb => cb.value);
                } else {
                    selectedSubjects = Object.keys(subjectData);
                }
                
                if (selectedSubjects.length === 0) {
                    alert('Please select at least one subject.');
                    return;
                }
                
                const testConfig = {
                    mode: 'practice-test',
                    dataSource: '2024',
                    testType: testType,
                    selectedSubjects: selectedSubjects,
                    questionCount: questionCount,
                    timeLimit: timeLimit,
                    totalAvailableQuestions: practiceQuestions.length
                };
                
                localStorage.setItem('testConfig', JSON.stringify(testConfig));
                updateDebugInfo('Starting practice test with config: ' + JSON.stringify(testConfig));
                window.location.href = 'test.html';
            }

            // Event listeners
            testTypeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customSubjectsDiv.style.display = 'block';
                } else {
                    customSubjectsDiv.style.display = 'none';
                }
                updateTestSummary();
            });

            questionCountSelect.addEventListener('change', updateTestSummary);
            timeLimitSelect.addEventListener('change', updateTestSummary);
            startButton.addEventListener('click', startPracticeTest);

            // Initialize the page
            try {
                if (initializePracticeData()) {
                    displaySubjectsOverview();
                    createSubjectCheckboxes();
                    updateTestSummary();
                    updateDebugInfo('Practice test configuration loaded successfully!');
                }
            } catch (error) {
                updateDebugInfo(`ERROR: ${error.message}`);
                console.error('Error initializing practice test:', error);
            }
        });
    </script>
</body>
</html>
